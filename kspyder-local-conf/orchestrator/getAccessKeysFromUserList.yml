Steps:

  - Name: GetRAMUsers
    Worker: aliyunRAMConnector
    Job: get_data
    Output: RAMUsersList
    Params:
      model_name: RAMUsers

  - Name: StoreRAMUsersToMongo
    Worker: mongoDBConnector
    Job: insert_dataset
    Input: RAMUsersList
    Output: RAMUsersInsertionResult

  - Name: FlattenUserList
    Worker: mongoDBConnector
    Job: execute_query
    Output: GetAccessKeysInputParams
    Params:
      query_name: FlattenRAMUserList
      query_conf:
        collection: RAMUsers
        dump_json: true
        dump_csv: true
        operations:
          $project:
            user_name: $UserName
          $set:
            model: AccessKeys
          $unset:
            - _id

  # GetKeysFromUserNames:
  #   Worker: aliyunRAMConnector
  #   Job: get_many_data
  #   Input: 
  #     - GetAccessKeysInputParams
  #   Output: RAMUserAccessKeys
  #   Params:
  #     model_name: AccessKeys
  #     user_name: $each.user_name
