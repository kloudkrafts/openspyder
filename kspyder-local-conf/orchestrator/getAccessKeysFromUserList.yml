Steps:

  - Name: GetRAMUsers
    Worker: aliyunRAMConnector
    Job: get_data
    Output: RAMUsersList
    Params:
      model_name: RAMUsers

  - Name: StoreRAMUsersToMongo
    Worker: mongoDBConnector
    Job: insert_dataset
    Input: RAMUsersList.data
    Output: RAMUsersInsertionResult
    Params:
      collection: RAMUsers

  - Name: FlattenUserList
    Worker: mongoDBConnector
    Job: execute_query
    Output: GetAccessKeysInputParams
    Params:
      query_name: FlattenRAMUserList
      query_conf:
        collection: RAMUsers
        dump_json: true
        dump_csv: true
        operations:
          $project:
            user_name: $UserName
          $unset:
            - _id

  - Name: GetKeysFromUserNames
    Worker: aliyunRAMConnector
    Job: get_many_data
    Input: GetAccessKeysInputParams.data
    Output: RAMUserAccessKeys
    Params:
      model_name: AccessKeys
