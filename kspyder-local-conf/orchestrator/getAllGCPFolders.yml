Steps:

  # - Name: DiscoverAllFolders
  #   Worker: gcloudResourceManagerConnector
  #   Job: discover_data
  #   Output: GCPFolders
  #   Params:
  #     model_name: Folders       
  #     root_element:
  #       level: 0
  #       display_name: christiandior.com
  #       name: organizations/68618737410

  # - Name: StoreFoldersToMongo
  #   Worker: mongoDBConnector
  #   Job: insert_dataset
  #   Input: GCPFolders.data
  #   Output: GCPFoldersInsertionResult
  #   Params:
  #     collection: GCPFolders

  # - Name: GetParentsList
  #   Job: get_unique_key_list
  #   Input: GCPFolders
  #   Output: GCPFolderIds
  #   Params:
  #     key: parent
  #     datapath: data[].name
  #     # filters:
  #     #   children: 0

  - Name: GetFoldersFromMongo
    Worker: mongoDBConnector
    Job: execute_query
    Output: GCPFolders
    Params:
      query_name: GetFolderIds
      query_conf:
        collection: GCPFolders
        operations:
          $project:
            name: $name
            display_name: $display_name
            parent: $parent
            children: $children
            level: $level
          $unset:
            - _id

  - Name: GetProjectLeaves
    Job: get_unique_key_list
    Input: GCPFolders
    Output: GCPFolderLeaves
    Params:
      key: name
      datapath: data[].name
      filters:
        children: 0

  - Name: StoreGCPFolderLeavesToMongo
    Worker: mongoDBConnector
    Job: insert_dataset
    Input: GCPFolderLeaves
    Output: GCPFolderLeavesInsertionResult
    Params:
      collection: GCPFolders_LeafIds
    

  # - Name: GetProjects
  #   Worker: gcloudResourceManagerConnector
  #   Job: get_data
  #   Output: GCPProjects
  #   Input: GCPFolderIds
  #   Params:
  #     model_name: Projects

  # - Name: StoreProjectsToMongo
  #   Worker: mongoDBConnector
  #   Job: insert_dataset
  #   Input: GCPProjects.data
  #   Output: GCPProjectsInsertionResult
  #   Params:
  #     collection: GCPProjects