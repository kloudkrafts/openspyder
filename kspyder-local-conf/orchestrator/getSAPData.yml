Steps:

  - Name: GetSAPProjectIds
    Worker: mongoDBConnector
    Job: execute_query
    Output: SAPProjectIds
    Params:
      query_name: GetSAPProjectIds
      query_conf:
        collection: GCPProjects
        operations:
          $match:
            display_name:
              # $regex: "sap"
              $regex: "(s4h)|(sap)|(spc)"
          $project:
            project: $display_name
          $unset:
            - _id
  
  - Name: GetSAPProjectRegions
    Worker: mongoDBConnector
    Job: execute_query
    Output: SAPProjectRegions
    Params:
      query_name: GetSAPProjectIds
      query_conf:
        collection: GCPProjects
        operations:
          $match:
            display_name:
              # $regex: "sap"
              $regex: "(s4h)|(sap)|(spc)"
          $set:
            region: europe-west4
          $project:
            project: $project_id
            region: 1
          $unset:
            - _id

  - Name: GetSAPProjectZones
    Worker: mongoDBConnector
    Job: execute_query
    Output: SAPProjectZones
    Params:
      query_name: GetSAPProjectZones
      query_conf:
        collection: GCPProjectZones
        operations:
          $match:
            project:
              # $regex: "sap"
              $regex: "(s4h)|(sap)|(spc)"
          $unset:
            - _id
  
  - Name: GetToMongo.ComputeInstances
    Job: get_data_to_mongo
    Input: SAPProjectZones.data
    Output: SAP_ComputeInstances
    Params:
      from_worker: gcloudConnector
      model_name: ComputeInstances
  
  - Name: GetToMongo.GCloudVPCs
    Job: get_data_to_mongo
    Input: SAPProjectIds.data
    Output: SAP_VPCs
    Params:
      from_worker: gcloudConnector
      model_name: GCloudVPCs

  - Name: GetToMongo.GCloudSubnets
    Job: get_data_to_mongo
    Input: SAPProjectRegions.data
    Output: SAP_Subnets
    Params:
      from_worker: gcloudConnector
      model_name: GCloudSubnets
